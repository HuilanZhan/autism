<!DOCTYPE html>
<meta charset='utf-8'>
<style>
body {
	font: 12px sans-serif;
	background-color: #ffffff;
}

legend {
	position:absolute;
	left:20px;
	top:30px;
}

.axis text {
	font: 10px sans-serif;
}

.axis line, .axis path {
	fill: none;
	stroke: #000;
	shape-rendering: crispEdges;
}

div.tooltip {
    position:absolute;
    text-align:center;
    width:200px;
    height:40px;
    padding-top: 15px;
    padding-bottom: 30px;
    font: 12px sans-serif;
    background: white;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
  }

 h1 {
 	text-align: center;
 }

.legend {
	position:absolute;
	left:800px;
	top:350px;
}


</style>
<body>

	<h1> Medicaid Waiver Accessibility for People <br> with Developmental Disabilities Varies Widely by State </h1>

		<!-- this is the map -->
	<div class = 'map'>
    <script src= 'https://d3js.org/d3.v4.min.js'></script>
    <script>
    var width = 960;
    var height = 500;

    var firstColor = '#acc875'
    var secondColor = '#ffe98b'
    var thirdColor = '#fdb240'
    var fourthColor = '#fb6828'
    var fifthColor = '#ee3b0e'
    var sixthColor = '#ec1010'
    
    var color = d3.scaleOrdinal()
                .range([firstColor, secondColor, thirdColor, fourthColor, fifthColor, sixthColor])
                .domain(['No Waitlist', 'Ratio: 0 - 0.5', 'Ratio: 0.5 - 1', 'Ratio: 1 - 1.5', 'Ratio: 1.5 - 2', "Ratio > 2"]);

    // Creates tooltip and makes it invisible by default.
    var tooltip = d3.select('body').append('div')
                    .attr('class', 'tooltip')
                    .style('opacity', 0);

    var project = d3.geoAlbersUsa()
        .scale([1000])
        .translate([width/2, height/2]);

    var path = d3.geoPath()
        .projection(project);

    var svg = d3.select('body')
        .append('svg')
        .attr('width', width)
        .attr('height', height);

    d3.csv('autism.csv', function(data) {
    	/*var dataArray = [];
    	for (var d = 0; d < data.length; d++) {
    		dataArray.push(parseFloat(data[d].value))
    	}
    	var minVal = 0;
    	var maxVal = d3.max(dataArray);
    	var ramp = d3.scaleLinear().domain([0, 1, maxVal]).range([firstColor, secondColor, thirdColor]);*/

    	d3.json('us-states.json', function(json){
    		for (var i = 0; i < data.length; i++) {
    			var dataState = data[i].state;
    			var dataValue = data[i].value;
    			var dataParticipants = data[i].participants;
    			var dataEnrollees = data[i].enrollees;

    			for (var j = 0; j < json.features.length; j++) {
    				var jsonState = json.features[j].properties.name;

    				if (dataState == jsonState) {
    					json.features[j].properties.value = dataValue;
    					json.features[j].properties.participants = dataParticipants;
    					json.features[j].properties.enrollees = dataEnrollees;

    					break;
    				}
    			}
    		}

            svg.selectAll('path')
                .data(json.features)
                .enter()
                .append('path')
                .attr('d', path)
                .style('stroke', '#fff')
                .style('stroke-width', '1')
                .style('fill', function(d) {
									//console.log(d);
									if(d.properties.value === "-1") {
										console.log("-1 value");
										return "#ddd";
									} else if (d.properties.value === '-2') {
										console.log('-2 value');
										return '#ddd';
									} else if (d.properties.value === '0') {
										return firstColor;
									} else if (d.properties.value >= '0.01' && d.properties.value < '0.5') {
										return secondColor;
									} else if (d.properties.value >= '0.5' && d.properties.value < '1') {
										return thirdColor;
									} else if (d.properties.value >= '1' && d.properties.value < '1.5') {
										return fourthColor;
									} else if (d.properties.value >= '1.5' && d.properties.value < '2') {
										return fifthColor;
									} else {
										return sixthColor;
									}
								})
                .on('mouseover', function(d){
									tooltip.transition().duration(200).style('opacity', .9);
									if (d.properties.value === '-1') {
										return tooltip.html('<strong>' + d.properties.name + '</strong><br><br>' + 'Data Unknown')
													 .style('left', (d3.event.pageX)+'px')
										       .style('top', (d3.event.pageY - 28) + 'px');
									} else if (d.properties.value === '-2') {
										return tooltip.html('<strong>' + d.properties.name + '</strong><br>' + '<br>Do not have 1915(c) HCBS waivers<br>')
													 .style('left', (d3.event.pageX)+'px')
										       .style('top', (d3.event.pageY - 28) + 'px');
									} else if (d.properties.value === '0') {
										return tooltip.html('<strong>' + d.properties.name + '</strong><br>' + 'No waitlist <br>' + 'People Using Waivers: ' + d.properties.participants)
													 .style('left', (d3.event.pageX)+'px')
										       .style('top', (d3.event.pageY - 28) + 'px');
									} else {
										return tooltip.html('<strong>' + d.properties.name + '</strong><br>' + 'Ratio: ' + d.properties.value + '<br> People Using Waivers: ' + d.properties.participants + '<br> People on Waitlist: ' + d.properties.enrollees)
										.style('left', (d3.event.pageX)+'px')
										.style('top', (d3.event.pageY - 28) + 'px');
									}
                })
                .on('mouseout', function(d){
                    tooltip.transition().duration(500).style('opacity', 0);
                });

        var legend = d3.select('body').append('svg')
                     .attr('class', 'legend')
                     .attr('width', 140)
                     .attr('height', 200)
                     .selectAll('g')
                     .data(color.domain().slice().reverse())
                     .enter().append('g')
                     .attr('transform', function(d, i) {
                     	return 'translate(0, ' + i * 20 + ')';
                     });

        legend.append('rect')
              .attr('width', 18)
              .attr('height', 18)
              .style('fill', color);

        legend.append('text')
              .attr('x', 24)
              .attr('y', 9)
              .attr('dy', '.35em')
              .text(function(d) {
              	return d;
              });
        // add a legend
		/*var w = 300, h = 40;

		var key = d3.select('body')
			.append('svg')
			.attr('width', w)
			.attr('height', h)
			.attr('class', 'legend');

		var legend = key.append('defs')
			.append('svg:linearGradient')
			.attr('id', 'gradient')
			.attr('x1', '100%')
			.attr('y1', '0%')
			.attr('x2', '100%')
			.attr('y2', '100%')
			.attr('spreadMethod', 'pad');

		legend.append('stop')
			.attr('offset', '0%')
			.attr('stop-color', sixthColor)
			.attr('stop-opacity', 1);

		legend.append('stop')
			.attr('offset', '0%')
			.attr('stop-color', fifthColor)
			.attr('stop-opacity', 1);

		legend.append('stop')
			.attr('offset', '0%')
			.attr('stop-color', fourthColor)
			.attr('stop-opacity', 1);

		legend.append('stop')
			.attr('offset', '0%')
			.attr('stop-color', thirdColor)
			.attr('stop-opacity', 1);

		legend.append('stop')
			.attr('offset', '50%')
			.attr('stop-color', secondColor)
			.attr('stop-opacity', 1);

		legend.append('stop')
			.attr('offset', '100%')
			.attr('stop-color', firstColor)
			.attr('stop-opacity', 1);

		key.append('rect')
			.attr('width', w - 100)
			.attr('height', h)
			.style('fill', 'url(#gradient)')
			.attr('transform', 'translate(0,10)');

		var y = d3.scaleLinear()
			.range([h, 0])
			.domain([0, maxVal]);

		var yAxis = d3.axisRight(y);

		key.append('g')
			.attr('class', 'y axis')
			.attr('transform', 'translate(41,10)')
			.call(yAxis)*/

    	});
    });

    </script>
</div>

    <p>People with developmental and intellectual disabilities must get a waiver to use Medicaid funds to cover home or community-based care services. But the waivers are hard to come by, with more than 400,000 Americans with disabilities waiting for them in 2016. The numbers vary widely by state. The map above shows the ratio of people on the waitlist to those currently using the waiver in each state. Some have no waitlist, while others have more people waiting than currently using the waiver.</p>

    <p id = 'source'> Sourceï¼šKaiser Family Foundation </p>

</body>
